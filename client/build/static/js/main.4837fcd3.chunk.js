(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{18:function(e,t,n){},46:function(e,t,n){},69:function(e,t,n){"use strict";n.r(t);var s=n(9),c=n.n(s),i=n(36),o=n.n(i),a=(n(46),n(12)),l=n(13),r=n(25),u=n.n(r),d=(n(18),n(8)),h=function(e){return Object(d.jsx)(d.Fragment,{children:Object(d.jsxs)("div",{className:"Row",children:[Object(d.jsx)("div",{className:"RowItem",style:{justifyContent:"flex-start",marginLeft:"5%"},children:Object(d.jsx)("div",{className:"Source",children:Object(d.jsx)("div",{className:"Info",children:Object(d.jsx)("button",{className:"HeaderButton",onClick:function(){window.location.href="https://github.com/gholmes829/Flow"},children:"Source"})})})}),Object(d.jsx)("div",{className:"RowItem",children:Object(d.jsx)("div",{className:"Title",children:"Flow"})}),Object(d.jsx)("div",{className:"RowItem",style:{justifyContent:"flex-end",marginRight:"5%"},children:Object(d.jsx)("div",{className:"Login",children:e.user.fetched&&!e.user.loggedIn?Object(d.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-evenly",width:"100%"},children:Object(d.jsx)("div",{style:{width:"50px"},children:Object(d.jsx)(u.a,{type:"cylon",height:"100%",width:"100%"})})}):Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{className:"Info",children:Object(d.jsx)("button",{className:"HeaderButton",onClick:function(){e.user.loggedIn?(e.setUser({name:"Guest",profilePic:"",playlists:[],loggedIn:!1,accessToken:"",fetched:!1}),e.setState({fetched:!1,analyzed:!1}),e.setSongSelection(""),e.setSelection({playlist:{name:"",songs:[]}})):window.location.href="http://catchthatflow.com:9000/spotify/login"},children:e.user.loggedIn?"Logout":"Login"})}),Object(d.jsx)("div",{className:"Info",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e.user.fetched||e.user.loggedIn?'"'+e.user.name+'"':"Guest"}),Object(d.jsx)("div",{className:"Info",children:""===e.user.profilePic?Object(d.jsx)("img",{className:"ProfilePic",src:"/assets/unknown.jpg",alt:"Unknown Pic"}):Object(d.jsx)("img",{className:"ProfilePic",src:e.user.profilePic,alt:"Profile Pic"})})]})})})]})})},j=n(27),f=function(e){return Object(d.jsx)(d.Fragment,{children:e.songs.map((function(t){return Object(d.jsx)("button",{id:t.uri,className:"Selectable",style:t.uri===e.songSelection.uri?{backgroundColor:"#8D8D8D"}:{},onClick:function(){e.setSongSelection(t),e.focusOn(t.uri)},children:'"'+t.name+'" - '+t.artists.join(", ")},t.uri)}))})},b=function(e){var t=function(t,n){fetch("http://catchthatflow.com:9000/spotify/analyzePlaylist",{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({songs:t}),method:"POST"}).then((function(e){return e.json()})).then((function(s){e.setSelection({playlist:{name:n,songs:t.map((function(e,t){return Object(a.a)(Object(a.a)({},e),{},{score:s.song_scores[t].score,cluster:s.song_scores[t].cluster})}))}}),e.setState(Object(a.a)(Object(a.a)({},e.state),{},{analyzed:!0}))}))};return Object(d.jsx)(d.Fragment,{children:e.user.playlists.map((function(n){return Object(d.jsx)("button",{className:"Selectable",onClick:function(){var s,c;s=n.id,c=n.name,e.setState(Object(a.a)(Object(a.a)({},e.state),{},{fetched:!0})),fetch("http://catchthatflow.com:9000/spotify/playlist/"+s+"/"+e.user.accessToken).then((function(e){return e.json()})).then((function(e){return e.playlist})).then((function(n){if(n){var s=n.map((function(e){return Object(a.a)(Object(a.a)({},e),{},{score:"",cluster:""})}));e.setSongSelection(n[0]),t(s,c)}else console.log("Potential error from excess API requests!!!")})).catch((function(e){return console.log("Error: "+e)}))},children:n.name},n.id)}))})},g=function(e){var t=Object(s.useState)([]),n=Object(l.a)(t,2),c=n[0],i=n[1],o=Object(s.useState)(!1),r=Object(l.a)(o,2),h=r[0],g=r[1],m="100%";return Object(d.jsx)(d.Fragment,{children:Object(d.jsxs)("div",{className:"Column",children:[Object(d.jsx)("div",{className:"Text",style:{whiteSpace:"nowrap",textOverflow:"ellipsis"},children:function(){var t,n=e.selection.playlist.name;return t=n.length<=12?n:n.substring(0,12)+"...",e.selection.playlist.name?t+" (Copy)":"My Playlists"}()}),e.user.loggedIn&&e.state.analyzed?Object(d.jsx)("div",{className:"Items",id:"Music",style:{height:m},children:Object(d.jsx)(f,{selection:e.selection,setSelection:e.setSelection,songSelection:e.songSelection,setSongSelection:e.setSongSelection,songs:e.selection.playlist.songs.filter((function(e){return!c.includes(e.uri)})),focusOn:e.focusOn})}):e.user.fetched&&!e.user.loggedIn||e.user.loggedIn&&e.state.fetched&&!e.state.analyzed?Object(d.jsx)("div",{className:"Items",id:"Music",style:{overflowY:"hidden",height:m,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:Object(d.jsx)("div",{style:{width:"50%",margin:"auto",marginTop:"10%",height:"50%"},children:Object(d.jsx)(u.a,{type:"spin",height:"100%",width:"100%"})})}):e.user.loggedIn&&!e.state.fetched?Object(d.jsx)("div",{className:"Items",id:"Music",style:{height:m},children:Object(d.jsx)(b,{user:e.user,selection:e.selection,setSelection:e.setSelection,setSongSelection:e.setSongSelection,setState:e.setState,state:e.state})}):e.user.loggedIn?void 0:Object(d.jsx)("div",{className:"Items",id:"Music",style:{height:m},children:Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("br",{}),"Log in and select playlist..."]})}),Object(d.jsx)("div",{className:"Controls",children:e.state.analyzed?Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("button",{className:"Control",onClick:function(){return t=e.songSelection,void(c.includes(t.uri)||i((function(n){var s=e.selection.playlist.songs.filter((function(e){return!c.includes(e.uri)&&e.uri!==t.uri}))[0];return e.setSongSelection(s),[].concat(Object(j.a)(c),[t.uri])})));var t},children:"Remove Song"}),h?Object(d.jsx)("button",{className:"Unactive",children:"Saving..."}):Object(d.jsx)("button",{className:"Control",onClick:function(){return function(){g(!0);var t=e.selection.playlist.songs.filter((function(e){return!c.includes(e.uri)})).map((function(e){return"spotify:track:"+e.uri}));fetch("http://catchthatflow.com:9000/spotify/createPlaylist/"+e.selection.playlist.name+" (Flow Copy)/"+e.user.accessToken,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({data:t}),method:"POST"}).then((function(e){g(!1)})).catch((function(e){return console.log("Error: "+e)}))}()},children:"Save Copy"}),Object(d.jsx)("button",{className:"Control",onClick:function(){e.setState(Object(a.a)(Object(a.a)({},e.state),{},{fetcned:!1,analyzed:!1})),e.setSelection({playlist:{songs:[],name:""}}),e.setSongSelection(""),document.getElementById("Music").scrollTo(0,0),i([]),fetch("http://catchthatflow.com:9000/spotify/userData/"+e.user.accessToken).then((function(e){return e.json()})).then((function(t){e.setUser((function(){return Object(a.a)(Object(a.a)({},e.user),{},{playlists:t.playlists})}))})).catch((function(e){return console.log("Error: "+e)}))},children:"Back"})]}):Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("button",{className:"Unactive",children:"Remove Song"}),Object(d.jsx)("button",{className:"Unactive",children:"Save a Copy"}),Object(d.jsx)("button",{className:"Unactive",children:"Back"})]})}),Object(d.jsx)("div",{className:"FrameContainer",children:e.state.fetched&&!e.state.analyzed?Object(d.jsx)("div",{style:{margin:"auto",width:"22.5%",overflow:"hidden"},children:Object(d.jsx)(u.a,{type:"cylon",height:"80px",width:"80px"})}):Object(d.jsx)("iframe",{title:"Sample",src:e.songSelection&&e.state.analyzed?"https://open.spotify.com/embed/track/"+e.songSelection.uri:"",width:"100%",height:"80px",frameBorder:"0",allowtransparency:"true",allow:"encrypted-media"})})]})})},m=n(40),O=(n(70),function(e){var t=Object(s.useRef)(),n=function(e){var n=1+60/Math.hypot(e.x,e.y,e.z);t.current.cameraPosition({x:e.x*n,y:e.y*n,z:e.z*n},e,3e3)},c={},i=Object(s.useCallback)((function(t){var s;e.songs.forEach((function(e){t.id===e.uri&&(s=e)})),e.setSongSelection(s),document.getElementById(t.id).scrollIntoView({behavior:"auto",block:"center"}),n(t)}),[t]),o=e.setFocusOn;return Object(s.useEffect)((function(){o((function(){return function(e){return n(c[e])}}))}),[o]),Object(d.jsx)(m.a,Object(a.a)(Object(a.a)({ref:t},e),{},{onNodeClick:i,nodeVisibility:function(t){return c[t.id]=t,!("nodeVisibility"in e)||e.nodeVisibility(t)}}))}),y=function(e){var t=Object(s.useState)(""),n=Object(l.a)(t,2),c=n[0],i=n[1],o={},a=100*Math.random(),r=function(){if(e.songs.length&&""!==e.songs[0].score){var t={};e.songs.forEach((function(e){e.cluster in t?t[e.cluster].push(e.uri):t[e.cluster]=[e.uri],o[e.uri]=e.cluster}));var n=e.songs.map((function(e){return{id:e.uri,name:'"'+e.name+'" ('+Math.round(100*e.score)/100+"% match)",val:1+30*e.score/100}})),s=[];return Object.keys(t).forEach((function(e){var n=t[e],c={};n.forEach((function(e){c[e]=0})),n.forEach((function(e){var t=n.indexOf(e);t!==n.length-1&&s.push({source:e,target:n[t+1]}),Object(j.a)(Array(5).keys()).forEach((function(t){if(Math.random()<.05){var c=Math.round((n.length-1)*Math.random()),i=n[c];i!==e&&s.push({source:e,target:i})}}))}))})),{nodes:n,links:s}}return{}}();return Object(s.useEffect)((function(){var e=document.getElementById("CmdItems").getBoundingClientRect();i((function(){return{width:e.width,height:e.height}}))}),[]),Object(d.jsx)(d.Fragment,{children:Object(d.jsxs)("div",{className:"Column",style:{width:"63.5%"},children:[Object(d.jsx)("div",{className:"Text",children:"Analysis Results"}),Object(d.jsx)("div",{className:"Items",id:"CmdItems",style:{height:"100%",overflowY:"hidden"},children:e.songs.length&&""!==e.songs[0].score?Object(d.jsx)(O,{graphData:r,width:c.width,height:c.height,nodeAutoColorBy:function(e){return o[e.id]+a},showNavInfo:!1,d3VelocityDecay:.55,songs:e.songs,setFocusOn:e.setFocusOn,setSongSelection:e.setSongSelection}):Object(d.jsxs)("div",{style:{width:"90%",margin:"auto",fontSize:"small"},children:[Object(d.jsx)("br",{}),Object(d.jsx)("h2",{children:"Notes:"}),Object(d.jsxs)("p",{children:["1) Analysis will show clustering and cohesion of songs in playlist.",Object(d.jsx)("br",{}),Object(d.jsx)("br",{}),"2) Songs in large clusters with high scores are a good fit!",Object(d.jsx)("br",{}),Object(d.jsx)("br",{}),'3) Song scores are all relative to the playlist, so every playlist has a "perfectly good" and "perfectly bad" fitting song.',Object(d.jsx)("br",{}),Object(d.jsx)("br",{}),"4) Algorithm is randomly initialized so analysis results for a given playlist may change.",Object(d.jsx)("br",{}),Object(d.jsx)("br",{}),"5) Links between nodes within a given cluster are randomly generated and thus have no meaning."]})]})})]})})},p=c.a.memo(y),x=function(){var e=Object(s.useState)({name:"Guest",profilePic:"",playlists:[],loggedIn:!1,accessToken:"",fetched:!1}),t=Object(l.a)(e,2),n=t[0],c=t[1],i=Object(s.useState)({fetched:!1,analyzed:!1}),o=Object(l.a)(i,2),r=o[0],u=o[1],j=Object(s.useState)({playlist:{name:"",songs:[]}}),f=Object(l.a)(j,2),b=f[0],m=f[1],O=Object(s.useState)((function(){})),y=Object(l.a)(O,2),x=y[0],S=y[1],v=Object(s.useState)(""),w=Object(l.a)(v,2),N=w[0],I=w[1];return Object(s.useEffect)((function(){!function(){if(window.location.hash.includes("success-")){c((function(e){return Object(a.a)(Object(a.a)({},e),{},{fetched:!0})}));var e=window.location.hash.replace("#login-success-","");window.location.hash="#login-success",fetch("http://catchthatflow.com:9000/spotify/userData/"+e).then((function(e){return e.json()})).then((function(t){c((function(n){return Object(a.a)(Object(a.a)({},n),{},{name:t.username,profilePic:t.profilePic,playlists:t.playlists,loggedIn:!0,accessToken:e})}))})).catch((function(e){return console.log("Error: "+e)}))}else window.location.hash="#sign-in"}()}),[]),Object(d.jsxs)("div",{className:"App",children:[Object(d.jsx)(h,{user:n,setUser:c,setSelection:m,setState:u,setSongSelection:I}),Object(d.jsxs)("div",{className:"Columns",children:[Object(d.jsx)(g,{user:n,setUser:c,selection:b,setSelection:m,songSelection:N,setSongSelection:I,state:r,setState:u,focusOn:x}),Object(d.jsx)(p,{songs:b.playlist.songs,setFocusOn:S,setSongSelection:I})]})]})};o.a.render(Object(d.jsx)(c.a.StrictMode,{children:Object(d.jsx)(x,{})}),document.getElementById("root"))}},[[69,1,2]]]);
//# sourceMappingURL=main.4837fcd3.chunk.js.map